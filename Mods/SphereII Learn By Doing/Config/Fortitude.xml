<configs>
	<append xpath="/buffs/buff[@name='ProgressionLearnByDoing_Init']">
		<effect_group name="Fortitude Perks">
			<!-- Add Initializers for Fortitude CVars -->
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$attFortitude_LBD_XP" operation="set" value="0"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$attFortitude_LBD_XPToNext" operation="set" value="5000"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkBrawler_LBD_XP" operation="set" value="0"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkBrawler_LBD_XPToNext" operation="set" value="1000"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkMachineGunner_LBD_XP" operation="set" value="0"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkMachineGunner_LBD_XPToNext" operation="set" value="1200"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkTheHuntsman_LBD_XP" operation="set" value="0"/>
			<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkTheHuntsman_LBD_XPToNext" operation="set" value="900"/>
			<!-- Apply the new Fortitude Manager Buff -->
			<triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffLBD_FortitudeManager"/>
		</effect_group>
	</append>
	<append xpath="/buffs">
		<!-- =============================================================================== -->
		<!-- ===================== FORTITUDE LEARN BY DOING SYSTEM ========================= -->
		<!-- =============================================================================== -->
		<!-- Buff #1: The FORTITUDE MANAGER BUFF -->
		<!-- This is the permanent buff that handles all LBD logic for the Fortitude attribute and its child perks. -->
       <!-- =============================================================================== -->
        <!-- ===================== FORTITUDE LEARN BY DOING SYSTEM ========================= -->
        <!-- =============================================================================== -->

        <!-- This is the permanent buff that handles all LBD logic for the Fortitude attribute and its child perks. -->
        <buff name="buffLBD_FortitudeManager" hidden="true">
            <stack_type value="ignore"/>
            
            <!-- Group for Fortitude Attribute -->
            <effect_group name="Fortitude">
                <requirement name="HoldingItemHasTags" tags="attFortitude"/>
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="ModifyCVar" cvar="$attFortitude_LBD_XP" operation="add" value="5">
                    <requirement name="NotHasBuff" buff="buffLBD_attFortitude_XPCoolDown"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_attFortitude_XPCoolDown">
                    <requirement name="NotHasBuff" buff="buffLBD_attFortitude_XPCoolDown"/>
                </triggered_effect>
                <!-- Level Up Check -->
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_attFortitude_LevelUpCheck">
                    <requirement name="CVarCompare" cvar="$attFortitude_LBD_XP" operation="GTE" value="@$attFortitude_LBD_XPToNext"/>
                </triggered_effect>
            </effect_group>

            <!-- Group for Brawler Perk -->
            <effect_group name="Brawler">
                <requirement name="HoldingItemHasTags" tags="perkBrawler"/>
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="ModifyCVar" cvar="$perkBrawler_LBD_XP" operation="add" value="10">
                    <requirement name="NotHasBuff" buff="buffLBD_perkBrawler_XPCoolDown"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkBrawler_XPCoolDown">
                    <requirement name="NotHasBuff" buff="buffLBD_perkBrawler_XPCoolDown"/>
                </triggered_effect>
                <!-- Level Up Check -->
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkBrawler_LevelUpCheck">
                    <requirement name="CVarCompare" cvar="$perkBrawler_LBD_XP" operation="GTE" value="@$perkBrawler_LBD_XPToNext"/>
                </triggered_effect>
            </effect_group>

            <!-- Group for Machine Gunner Perk -->
            <effect_group name="Machine Gunner">
                <requirement name="HoldingItemHasTags" tags="perkMachineGunner"/>
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="ModifyCVar" cvar="$perkMachineGunner_LBD_XP" operation="add" value="15">
                    <requirement name="NotHasBuff" buff="buffLBD_perkMachineGunner_XPCoolDown"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkMachineGunner_XPCoolDown">
                    <requirement name="NotHasBuff" buff="buffLBD_perkMachineGunner_XPCoolDown"/>
                </triggered_effect>
                <!-- Level Up Check -->
                <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkMachineGunner_LevelUpCheck">
                    <requirement name="CVarCompare" cvar="$perkMachineGunner_LBD_XP" operation="GTE" value="@$perkMachineGunner_LBD_XPToNext"/>
                </triggered_effect>
            </effect_group>

            <!-- Group for The Huntsman Perk -->
            <effect_group name="The Huntsman">
                <requirement name="HoldingItemHasTags" tags="butcherTools"/>
                <requirement name="HarvestedSourceIsAnAnimal"/> <!-- Assuming SCore or a similar custom requirement -->
                <triggered_effect trigger="onSelfHarvestOther" action="ModifyCVar" cvar="$perkTheHuntsman_LBD_XP" operation="add" value="20">
                    <requirement name="NotHasBuff" buff="buffLBD_perkTheHuntsman_XPCoolDown"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfHarvestOther" action="AddBuff" buff="buffLBD_perkTheHuntsman_XPCoolDown">
                    <requirement name="NotHasBuff" buff="buffLBD_perkTheHuntsman_XPCoolDown"/>
                </triggered_effect>
                <!-- Level Up Check -->
                <triggered_effect trigger="onSelfHarvestOther" action="AddBuff" buff="buffLBD_perkTheHuntsman_LevelUpCheck">
                    <requirement name="CVarCompare" cvar="$perkTheHuntsman_LBD_XP" operation="GTE" value="@$perkTheHuntsman_LBD_XPToNext"/>
                </triggered_effect>
            </effect_group>

            <!-- Placeholders for remaining Fortitude perks to be implemented later -->
            <effect_group name="Flurry of Blows" />
            <effect_group name="Pain Tolerance" />
            <effect_group name="Fortitude Mastery" />
            <effect_group name="Siphoning Strikes" />
            <effect_group name="Healing Factor" />
            <effect_group name="Slow Metabolism" />
            <effect_group name="Rule #1: Cardio" />

        </buff>
		<!-- Buff #2: SUPPORTING BUFFS (Cooldowns and Level-Up Handlers) -->
		<!-- Cooldowns -->
		<buff name="buffLBD_attFortitude_XPCoolDown" hidden="true">
			<duration value="1"/>
		</buff>
		<buff name="buffLBD_perkBrawler_XPCoolDown" hidden="true">
			<duration value="1"/>
		</buff>
		<buff name="buffLBD_perkMachineGunner_XPCoolDown" hidden="true">
			<duration value="1"/>
		</buff>
		<buff name="buffLBD_perkTheHuntsman_XPCoolDown" hidden="true">
			<duration value="2"/>
		</buff>
		<!-- Level-Up Handlers -->
		<buff name="buffLBD_attFortitude_LevelUpCheck" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1"/>
			<effect_group>
				<requirement name="!RequirementIsProgressionLocked, SCore" progression_name="attFortitude"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="attFortitude" level="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$attFortitude_LBD_XP" operation="subtract" value="@$attFortitude_LBD_XPToNext"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$attFortitude_LBD_XPToNext" operation="multiply" value="1.3"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="ui_level_up"/>
			</effect_group>
		</buff>
		<buff name="buffLBD_perkBrawler_LevelUpCheck" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1"/>
			<effect_group>
				<requirement name="!RequirementIsProgressionLocked, SCore" progression_name="perkBrawler"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkBrawler" level="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkBrawler_LBD_XP" operation="subtract" value="@$perkBrawler_LBD_XPToNext"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkBrawler_LBD_XPToNext" operation="multiply" value="1.2"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="ui_level_up"/>
			</effect_group>
		</buff>
		<buff name="buffLBD_perkMachineGunner_LevelUpCheck" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1"/>
			<effect_group>
				<requirement name="!RequirementIsProgressionLocked, SCore" progression_name="perkMachineGunner"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkMachineGunner" level="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkMachineGunner_LBD_XP" operation="subtract" value="@$perkMachineGunner_LBD_XPToNext"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkMachineGunner_LBD_XPToNext" operation="multiply" value="1.2"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="ui_level_up"/>
			</effect_group>
		</buff>
		<buff name="buffLBD_perkTheHuntsman_LevelUpCheck" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1"/>
			<effect_group>
				<requirement name="!RequirementIsProgressionLocked, SCore" progression_name="perkTheHuntsman"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkTheHuntsman" level="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkTheHuntsman_LBD_XP" operation="subtract" value="@$perkTheHuntsman_LBD_XPToNext"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkTheHuntsman_LBD_XPToNext" operation="multiply" value="1.2"/>
				<triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="ui_level_up"/>
			</effect_group>
		</buff>
	</append>
</configs>
