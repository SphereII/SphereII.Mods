<!--
    ====================================================================================================
    ========================= INTELLECT MASTERY LEARN BY DOING (LBD) SYSTEM ============================
    ====================================================================================================

    This file defines the Mastery Checker buff for attIntellect.

    HOW IT WORKS:
    This temporary buff is triggered by `buffLBD_attIntellect_LevelUpCheck` whenever the player's
    main `attIntellect` attribute levels up. It then checks the current level of `attIntellect`
    and, if it matches a predefined milestone, triggers a level-up for `perkIntellectMastery`.

    -   **Progression Trigger:** This buff is applied by `buffLBD_attIntellect_LevelUpCheck`.
    -   **Staggered Unlocks:** `perkIntellectMastery` will level up at specific milestones of the `attIntellect` attribute:
        -   Tier 1: at `attIntellect` Level 3
        -   Tier 2: at `attIntellect` Level 5
        -   Tier 3: at `attIntellect` Level 7
        -   Tier 4: at `attIntellect` Level 9
        -   Tier 5: at `attIntellect` Level 10
    -   **Internal Tracking:** The `$perkintellectmastery_lbd_level` CVar is used to ensure
        each tier is only unlocked once.

    This design ensures that overall proficiency in Intellect (developed by crafting, trading,
    and using advanced tech) leads to the ultimate mastery of the attribute.

    ====================================================================================================
-->
<configs>
    <append xpath="/buffs">
        <buff name="buffLBD_attIntellect_MasteryChecker" hidden="true">
            <duration value="0.1"/> <!-- Very short duration, just long enough to process -->

            <!-- Log message for debugging the checker's activation. -->
            <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery Checker Fired. Checking for Mastery level up.">
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>

            <!-- Level 1 Mastery (at attIntellect Level 3) -->
            <effect_group name="Mastery Level 1">
                <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="3"/>
                <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="1"/>
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery - Triggering Level Up Check (Tier 1)">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffLBD_perkIntellectMastery_LevelUpCheck"/>
            </effect_group>

            <!-- Level 2 Mastery (at attIntellect Level 5) -->
            <effect_group name="Mastery Level 2">
                <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="5"/>
                <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="2"/>
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery - Triggering Level Up Check (Tier 2)">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffLBD_perkIntellectMastery_LevelUpCheck"/>
            </effect_group>

            <!-- Level 3 Mastery (at attIntellect Level 7) -->
            <effect_group name="Mastery Level 3">
                <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="7"/>
                <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="3"/>
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery - Triggering Level Up Check (Tier 3)">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffLBD_perkIntellectMastery_LevelUpCheck"/>
            </effect_group>

            <!-- Level 4 Mastery (at attIntellect Level 9) -->
            <effect_group name="Mastery Level 4">
                <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="9"/>
                <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="4"/>
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery - Triggering Level Up Check (Tier 4)">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffLBD_perkIntellectMastery_LevelUpCheck">
                    <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="9"/>
                    <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="4"/>
                </triggered_effect>
            </effect_group>

            <!-- Level 5 Mastery (at attIntellect Level 10) -->
            <effect_group name="Mastery Level 5">
                <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="10"/>
                <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="5"/>
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery - Triggering Level Up Check (Tier 5)">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
                <triggered_effect trigger="onSelfBuffStart" action="AddBuff" buff="buffLBD_perkIntellectMastery_LevelUpCheck">
                    <requirement name="ProgressionLevel" progression_name="attIntellect" operation="Equals" value="10"/>
                    <requirement name="CVarCompare" cvar="$perkintellectmastery_lbd_level" operation="LT" value="5"/>
                </triggered_effect>
            </effect_group>
        </buff>
        <buff name="buffLBD_perkIntellectMastery_LevelUpCheck" hidden="true">
            <stack_type value="ignore"/><duration value="1"/>
            <effect_group>
                <requirement name="!RequirementIsProgressionLocked, SCore" progression_name="perkIntellectMastery" />
                <triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkIntellectMastery" level="1"/>
                <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkintellectmastery_lbd_level" operation="add" value="1"/>
                <triggered_effect trigger="onSelfBuffStart" action="ShowPerkLevelUp, SCore" perk="perkIntellectMastery" sound="read_skillbook_final" />
            </effect_group>
            <effect_group>
                <requirement name="RequirementIsProgressionLocked, SCore" progression_name="perkIntellectMastery" />
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Intellect Mastery - Level Up FAILED. Perk is locked by requirements.">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
            </effect_group>
        </buff>
    </append>
</configs>