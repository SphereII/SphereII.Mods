<configs>
    <!-- Append the LBD logic for Miner 69'r to the main Strength Manager buff. -->
    <append xpath="/buffs/buff[@name='buffLBD_StrengthManager']">
        <!-- Group for Miner 69'r Perk -->
        <effect_group name="Miner 69'r">
            <requirement name="HoldingItemHasTags" tags="miningTool,shovel"/>
            <requirement name="RequirementBlockHasHarvestTags, SCore" tags="allHarvest,oreWoodHarvest"/>

            <!-- Primary swing -->
            <triggered_effect trigger="onSelfPrimaryActionRayHit" action="ModifyCVar" cvar="$perkminer69r_lbd_xp"
                              operation="add" value="@$lbd_xp_melee_base">
                <requirement name="NotHasBuff" buff="buffLBD_perkMiner69r_XPCoolDown"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff"
                              buff="buffLBD_perkMiner69r_XPCoolDown">
                <requirement name="NotHasBuff" buff="buffLBD_perkMiner69r_XPCoolDown"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff"
                              buff="buffLBD_perkMiner69r_LevelUpCheck">
                <requirement name="CVarCompare" cvar="$perkminer69r_lbd_xp" operation="GTE"
                             value="@$perkminer69r_lbd_xptonext"/>
            </triggered_effect>

            <!-- Power strike -->
            <triggered_effect trigger="onSelfSecondaryActionRayHit" action="ModifyCVar" cvar="$perkminer69r_lbd_xp"
                              operation="add" value="@$lbd_xp_melee_power_base">
                <requirement name="NotHasBuff" buff="buffLBD_perkMiner69r_XPCoolDown"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfSecondaryActionRayHit" action="AddBuff"
                              buff="buffLBD_perkMiner69r_XPCoolDown">
                <requirement name="NotHasBuff" buff="buffLBD_perkMiner69r_XPCoolDown"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfSecondaryActionRayHit" action="AddBuff"
                              buff="buffLBD_perkMiner69r_LevelUpCheck">
                <requirement name="CVarCompare" cvar="$perkminer69r_lbd_xp" operation="GTE"
                             value="@$perkminer69r_lbd_xptonext"/>
            </triggered_effect>

            <!-- Debug Messages -->
            <triggered_effect trigger="onSelfPrimaryActionRayHit" action="LogMessage"
                              message="LBD DEBUG: Miner 69'r Primary - Attempting XP Gain">
                <requirement name="NotHasBuff" buff="buffLBD_perkMiner69r_XPCoolDown"/>
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfSecondaryActionRayHit" action="LogMessage"
                              message="LBD DEBUG: Miner 69'r Power - Attempting XP Gain">
                <requirement name="NotHasBuff" buff="buffLBD_perkMiner69r_XPCoolDown"/>
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>
        </effect_group>
    </append>
    <!-- Define the Level-Up Handler buff for Miner 69'r. -->
    <append xpath="/buffs">
        <buff name="buffLBD_perkMiner69r_LevelUpCheck" hidden="true">
            <stack_type value="ignore"/>
            <duration value="1"/>
            <effect_group>
                <requirement name="!RequirementIsProgressionLocked, SCore" progression_name="perkMiner69r"/>
                <triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkMiner69r"
                                  level="1"/>
                <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkminer69r_lbd_xp"
                                  operation="subtract" value="@$perkminer69r_lbd_xptonext"/>
                <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkminer69r_lbd_xptonext"
                                  operation="multiply" value="1.2"/>
                <triggered_effect trigger="onSelfBuffStart" action="ShowPerkLevelUp, SCore" perk="perkMiner69r"
                                  sound="read_skillbook_final"/>
            </effect_group>
            <effect_group>
                <requirement name="RequirementIsProgressionLocked, SCore" progression_name="perkMiner69r"/>
                <triggered_effect trigger="onSelfBuffStart" action="LogMessage"
                                  message="LBD DEBUG: Miner 69'r - Level Up FAILED. Perk is locked by requirements.">
                    <requirement name="HasBuff" buff="god"/>
                </triggered_effect>
            </effect_group>
        </buff>
    </append>
</configs>