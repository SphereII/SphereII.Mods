<configs>
	<append xpath="/buffs/buff[@name='buffLBD_PerceptionManager']">
		<!-- Group for Salvage Operations Perk -->
		<effect_group name="Salvage Operations">
			<requirement name="HoldingItemHasTags" tags="perkSalvageOperations"/>
			<requirement name="RequirementBlockHasHarvestTags, SCore" tags="salvageHarvest"/>

			<triggered_effect trigger="onSelfPrimaryActionRayHit" action="ModifyCVar" cvar="$perksalvageoperations_lbd_xp" operation="add" value="@$lbd_xp_harvest_base">
				<requirement name="NotHasBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown">
				<requirement name="NotHasBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkSalvageOperations_LevelUpCheck">
				<requirement name="CVarCompare" cvar="$perksalvageoperations_lbd_xp" operation="GTE" value="@$perksalvageoperations_lbd_xptonext"/>
			</triggered_effect>

			<triggered_effect trigger="onSelfSecondaryActionRayHit" action="ModifyCVar" cvar="$perksalvageoperations_lbd_xp" operation="add" value="@$lbd_xp_melee_power_base">
				<requirement name="NotHasBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfSecondaryActionRayHit" action="AddBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown">
				<requirement name="NotHasBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfSecondaryActionRayHit" action="AddBuff" buff="buffLBD_perkSalvageOperations_LevelUpCheck">
				<requirement name="CVarCompare" cvar="$perksalvageoperations_lbd_xp" operation="GTE" value="@$perksalvageoperations_lbd_xptonext"/>
			</triggered_effect>

			<triggered_effect trigger="onSelfPrimaryActionRayHit" action="LogMessage" message="LBD DEBUG: Salvage Operations Primary - Attempting XP Gain (+@$lbd_xp_harvest_base)">
				<requirement name="NotHasBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown"/>
				<requirement name="HasBuff" buff="god"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfSecondaryActionRayHit" action="LogMessage" message="LBD DEBUG: Salvage Operations Power - Attempting XP Gain (+@$lbd_xp_melee_power_base)">
				<requirement name="NotHasBuff" buff="buffLBD_perkSalvageOperations_XPCoolDown"/>
				<requirement name="HasBuff" buff="god"/>
			</triggered_effect>
		</effect_group>
	</append>
	<append xpath="/buffs">
		<buff name="buffLBD_perkSalvageOperations_LevelUpCheck" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1"/>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkSalvageOperations" level="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perksalvageoperations_lbd_xp" operation="subtract" value="@$perksalvageoperations_lbd_xptonext"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perksalvageoperations_lbd_xptonext" operation="multiply" value="@$lbd_xp_curve_multiplier"/>
				<triggered_effect trigger="onSelfBuffStart" action="ShowToolbeltMessage" message_key="perkSalvageOperationsLeveledUp"/>
			</effect_group>
			<effect_group>
				<triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Salvage Operations - Level Up FAILED. Perk is locked by requirements.">
					<requirement name="HasBuff" buff="god"/>
				</triggered_effect>
			</effect_group>
		</buff>
	</append>
</configs>