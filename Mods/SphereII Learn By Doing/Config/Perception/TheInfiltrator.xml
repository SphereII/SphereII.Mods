<configs>
    <append xpath="/buffs/buff[@name='buffLBD_PerceptionManager']">
        <effect_group name="The Infiltrator">
            <triggered_effect trigger="onSelfPlaceBlock" action="LogMessage"
                              message="LBD DEBUG: The Infiltrator - TRAP PLACED! Attempting XP Gain (+75)">
                <requirement name="HoldingItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
                <requirement name="CVarCompare" cvar="$infiltrator_placement_credits" operation="GT" value="0"/>
                <requirement name="NotHasBuff" buff="buffLBD_perkInfiltrator_ActionCoolDown"/>
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfPlaceBlock" action="ModifyCVar" cvar="$perkinfiltrator_lbd_xp"
                              operation="add" value="75">
                <requirement name="HoldingItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
                <requirement name="CVarCompare" cvar="$infiltrator_placement_credits" operation="GT" value="0"/>
                <requirement name="NotHasBuff" buff="buffLBD_perkInfiltrator_ActionCoolDown"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfPlaceBlock" action="ModifyCVar" cvar="$infiltrator_placement_credits"
                              operation="subtract" value="1">
                <requirement name="HoldingItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
                <requirement name="CVarCompare" cvar="$infiltrator_placement_credits" operation="GT" value="0"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfItemCrafted" action="LogMessage"
                              message="LBD DEBUG: The Infiltrator - Trap Crafted! Attempting XP Gain (+20) and adding Placement Credit.">
                <requirement name="ItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
                <requirement name="NotHasBuff" buff="buffLBD_perkInfiltrator_ActionCoolDown"/>
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfItemCrafted" action="ModifyCVar" cvar="$perkinfiltrator_lbd_xp"
                              operation="add" value="20">
                <requirement name="ItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
                <requirement name="NotHasBuff" buff="buffLBD_perkInfiltrator_ActionCoolDown"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfItemCrafted" action="ModifyCVar" cvar="$infiltrator_placement_credits"
                              operation="add" value="1">
                <requirement name="ItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfCloseLootContainer" action="LogMessage"
                              message="LBD DEBUG: The Infiltrator - Trap Looted! Adding Placement Credit.">
                <requirement name="ItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfCloseLootContainer" action="ModifyCVar"
                              cvar="$infiltrator_placement_credits" operation="add" value="1">
                <requirement name="ItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfPlaceBlock" action="AddBuff" buff="buffLBD_perkInfiltrator_ActionCoolDown">
                <requirement name="HoldingItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfItemCrafted" action="AddBuff"
                              buff="buffLBD_perkInfiltrator_ActionCoolDown">
                <requirement name="ItemHasTags" tags="Mine,Mine2,Mine3,Mine4"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfPlaceBlock" action="AddBuff" buff="buffLBD_perkInfiltrator_LevelUpCheck">
                <requirement name="CVarCompare" cvar="$perkinfiltrator_lbd_xp" operation="GTE"
                             value="@$perkinfiltrator_lbd_xptonext"/>
            </triggered_effect>
            <triggered_effect trigger="onSelfItemCrafted" action="AddBuff" buff="buffLBD_perkInfiltrator_LevelUpCheck">
                <requirement name="CVarCompare" cvar="$perkinfiltrator_lbd_xp" operation="GTE"
                             value="@$perkinfiltrator_lbd_xptonext"/>
            </triggered_effect>
        </effect_group>
    </append>
    <append xpath="/buffs">
    <buff name="buffLBD_perkInfiltrator_LevelUpCheck" hidden="true">
        <stack_type value="ignore"/>
        <duration value="1"/>
        <effect_group>
            <triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkInfiltrator" level="1"/>
            <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkinfiltrator_lbd_xp" operation="subtract" value="@$perkinfiltrator_lbd_xptonext"/>
            <triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perkinfiltrator_lbd_xptonext" operation="multiply" value="@$lbd_xp_curve_multiplier"/>
            <triggered_effect trigger="onSelfBuffStart" action="ShowToolbeltMessage" message_key="perkInfiltratorLeveledUp"/>
            <triggered_effect trigger="onSelfBuffStart" action="PlaySound" sound="ui_level_up"/>
        </effect_group>
        <effect_group>
            <triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: The Infiltrator - Level Up FAILED. Perk is locked by requirements.">
                <requirement name="HasBuff" buff="god"/>
            </triggered_effect>
        </effect_group>
    </buff>
    </append>
</configs>