<configs>
<append xpath="/buffs/buff[@name='buffLBD_PerceptionManager']">
	<!-- Group for Treasure Hunter Perk -->
	<effect_group name="Treasure Hunter">
		<requirement name="RequirementQuestObjective, SCore" objective="TreasureChest"/>
		<triggered_effect trigger="onSelfPrimaryActionRayHit" action="LogMessage" message="LBD DEBUG: Treasure Hunter - DIGGING! Attempting XP Gain (+5)">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
			<requirement name="NotHasBuff" buff="buffLBD_perkTreasureHunter_DigCoolDown"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfPrimaryActionRayHit" action="ModifyCVar" cvar="$perktreasurehunter_lbd_xp" operation="add" value="5">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
			<requirement name="NotHasBuff" buff="buffLBD_perkTreasureHunter_DigCoolDown"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfCloseLootContainer" action="LogMessage" message="LBD DEBUG: Treasure Hunter - TREASURE CHEST OPENED! Attempting XP Gain (+150)">
			<requirement name="RequirementIsTargetBlock, SCore" tags="buriedTreasure"/>
			<requirement name="NotHasBuff" buff="buffLBD_perkTreasureHunter_LootCoolDown"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfCloseLootContainer" action="ModifyCVar" cvar="$perktreasurehunter_lbd_xp" operation="add" value="150">
			<requirement name="RequirementIsTargetBlock, SCore" tags="buriedTreasure"/>
			<requirement name="NotHasBuff" buff="buffLBD_perkTreasureHunter_LootCoolDown"/>
		</triggered_effect>

		<triggered_effect trigger="onSelfSecondaryActionRayHit" action="LogMessage" message="LBD DEBUG: Treasure Hunter - SECONDARY DIGGING! Attempting XP Gain (+5)">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
			<requirement name="NotHasBuff" buff="buffLBD_perkTreasureHunter_DigCoolDown"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfSecondaryActionRayHit" action="ModifyCVar" cvar="$perktreasurehunter_lbd_xp" operation="add" value="5">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
			<requirement name="NotHasBuff" buff="buffLBD_perkTreasureHunter_DigCoolDown"/>
		</triggered_effect>

		<triggered_effect trigger="onSelfPrimaryActionRayHit" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Applying Dig Cooldown">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkTreasureHunter_DigCoolDown">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfCloseLootContainer" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Applying Loot Cooldown">
			<requirement name="RequirementIsTargetBlock, SCore" tags="buriedTreasure"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfCloseLootContainer" action="AddBuff" buff="buffLBD_perkTreasureHunter_LootCoolDown">
			<requirement name="RequirementIsTargetBlock, SCore" tags="buriedTreasure"/>
		</triggered_effect>

		<triggered_effect trigger="onSelfSecondaryActionRayHit" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Applying Dig Cooldown (Secondary)">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfSecondaryActionRayHit" action="AddBuff" buff="buffLBD_perkTreasureHunter_DigCoolDown">
			<requirement name="HoldingItemHasTags" tags="tool"/>
			<requirement name="RequirementIsTargetBlock, SCore" tags="treasureHunter"/>
		</triggered_effect>

		<triggered_effect trigger="onSelfPrimaryActionRayHit" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Triggering Level Up Check (from Dig)">
			<requirement name="CVarCompare" cvar="$perktreasurehunter_lbd_xp" operation="GTE" value="@$perktreasurehunter_lbd_xptonext"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfPrimaryActionRayHit" action="AddBuff" buff="buffLBD_perkTreasureHunter_LevelUpCheck">
			<requirement name="CVarCompare" cvar="$perktreasurehunter_lbd_xp" operation="GTE" value="@$perktreasurehunter_lbd_xptonext"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfCloseLootContainer" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Triggering Level Up Check (from Loot)">
			<requirement name="CVarCompare" cvar="$perktreasurehunter_lbd_xp" operation="GTE" value="@$perktreasurehunter_lbd_xptonext"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfCloseLootContainer" action="AddBuff" buff="buffLBD_perkTreasureHunter_LevelUpCheck">
			<requirement name="CVarCompare" cvar="$perktreasurehunter_lbd_xp" operation="GTE" value="@$perktreasurehunter_lbd_xptonext"/>
		</triggered_effect>

		<triggered_effect trigger="onSelfSecondaryActionRayHit" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Triggering Level Up Check (from Secondary Dig)">
			<requirement name="CVarCompare" cvar="$perktreasurehunter_lbd_xp" operation="GTE" value="@$perktreasurehunter_lbd_xptonext"/>
			<requirement name="HasBuff" buff="god"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfSecondaryActionRayHit" action="AddBuff" buff="buffLBD_perkTreasureHunter_LevelUpCheck">
			<requirement name="CVarCompare" cvar="$perktreasurehunter_lbd_xp" operation="GTE" value="@$perktreasurehunter_lbd_xptonext"/>
		</triggered_effect>
	</effect_group>
	</append>

	<append xpath="/buffs">
		<buff name="buffLBD_perkTreasureHunter_LevelUpCheck" hidden="true">
			<stack_type value="ignore"/>
			<duration value="1"/>
			<effect_group>
				<requirement name="CanPurchasePerk, SCore" progression_name="perkTreasureHunter"/>
				<triggered_effect trigger="onSelfBuffStart" action="AddProgressionLevel" progression_name="perkTreasureHunter" level="1"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perktreasurehunter_lbd_xp" operation="subtract" value="@$perktreasurehunter_lbd_xptonext"/>
				<triggered_effect trigger="onSelfBuffStart" action="ModifyCVar" cvar="$perktreasurehunter_lbd_xptonext" operation="multiply" value="@$lbd_xp_curve_multiplier"/>
				<triggered_effect trigger="onSelfBuffStart" action="ShowToolbeltMessage" message_key="perkTreasureHunterLeveledUp"/>
			</effect_group>
			<effect_group>
				<requirement name="!CanPurchasePerk, SCore" progression_name="perkTreasureHunter"/>
				<triggered_effect trigger="onSelfBuffStart" action="LogMessage" message="LBD DEBUG: Treasure Hunter - Level Up FAILED. Perk is locked by requirements.">
					<requirement name="HasBuff" buff="god"/>
				</triggered_effect>
			</effect_group>
		</buff>
	</append>
</configs>